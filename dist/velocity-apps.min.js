/**
 * Velocity Apps - v1.0.0-alpha1 - 2018-07-04
 * Description: Velocity Apps is application and controllers library for CMSGears.
 * License: GPL-3.0-or-later
 * Author: Bhagwat Singh Chouhan
 */


function initAddress(){jQuery("#btn-add-address").click(function(){addAddress("#"+jQuery(this).attr("data-target"))})}function addAddress(e){var t=document.getElementById("addAddressTemplate").innerHTML,r=Handlebars.compile(t)({});(e=jQuery(e).find(".address-form-wrap")).hide(),e.html(r),e.fadeIn("slow"),cmt.api.utils.request.registerTargetApp("address",e),cmt.api.utils.request.registerTargetApp("location",e),e.find(".cmt-select").cmtSelect({iconHtml:'<span class="cmti cmti-chevron-down"></span>'}),e.find(".address-form-close").click(function(){e.hide()}),initGoogleMap(e)}function updateAddress(e,t){var r=document.getElementById("updateAddressTemplate").innerHTML,o=Handlebars.compile(r)({cid:e,address:t}),i=jQuery("#box-crud-address").find(".frm-address");i.hide(),i.html(o),i.fadeIn("slow"),cmt.api.utils.request.register(cmt.api.root.getApplication("address"),i.find("[cmt-app=address]")),i.find(".address-province").val(i.find(".address-province").attr("pid")),i.find(".cmt-select").cmtSelect({iconHtml:'<span class="cmti cmti-chevron-down"></span>'}),initListingRegMap()}function addAddressCard(e){var t=document.getElementById("addressCardTemplate").innerHTML,r=Handlebars.compile(t)({address:e}),o=jQuery("#box-crud-address").find(".mapper-items");o.append(r),cmt.api.utils.request.register(cmt.api.root.getApplication("address"),o.find("[cmt-app=address]"))}function refreshAddressCard(e){var t=document.getElementById("refreshAddressCardTemplate").innerHTML,r=Handlebars.compile(t)({address:e}),o=jQuery("#box-crud-address").find(".mapper-items").find("#mapper-item-"+e.cid);o.html(r),jQuery("#box-crud-address").find(".frm-address").fadeOut(),cmt.api.utils.request.register(cmt.api.root.getApplication("address"),o.find("[cmt-app=address]"))}function initCommentListeners(){jQuery(".reviews-uploader").cmtFileUploader({uploadListener:reviewItemListener}),jQuery(".review-items-wrap .btn-delete").click(function(){jQuery(this).closest(".review-item").remove(),resetReviewItemCounter()})}function reviewItemListener(e,t,r,o){var i=jQuery(".reviews-uploader .form-wrap"),l=i.find(".title"),n=i.find(".desc"),a=jQuery(".review-items-wrap .review-item").length,c=document.getElementById("reviewItemTemplate").innerHTML,s=Handlebars.compile(c)({count:a,data:o,title:l.val(),description:n.val()});l.val(""),n.val(""),jQuery(".review-items-wrap").append(s),jQuery(".review-items-wrap .btn-delete").last().click(function(){jQuery(this).closest(".review-item").remove(),resetReviewItemCounter()}),resetReviewItemCounter()}function resetReviewItemCounter(){jQuery(".review-items-wrap .review-item").each(function(e,t){var r=jQuery(this);r.find(".id").attr("name","File["+e+"][id]"),r.find(".name").attr("name","File["+e+"][name]"),r.find(".extension").attr("name","File["+e+"][extension]"),r.find(".directory").attr("name","File["+e+"][directory]"),r.find(".type").attr("name","File["+e+"][type]"),r.find(".changed").attr("name","File["+e+"][changed]"),r.find(".title").attr("name","File["+e+"][title]"),r.find(".description").attr("name","File["+e+"][description]")})}var cmg;function processAutoSearch(e,t,r){var o=document.getElementById(r).innerHTML,i=(r=Handlebars.compile(o),jQuery(".mapper-auto-categories").find(".mapper-items")),l=i.find(".mapper-item"),n=l.length;if(jQuery(".mapper-auto-categories .search-name").val(""),5<=n)alert("No more mappings allowed.");else{for(var a=!0,c=0;c<n;c++){if(e==jQuery(l[c]).find(".id").val()){a=!1;break}}if(a){var s=r({id:e,name:t});i.append(s),n=(l=i.find(".mapper-item")).length,l.last().find(".mapper-item-remove").click(function(){jQuery(this).closest(".mapper-item").remove()})}}}jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("address","cmt.api.Application",{basePath:ajaxUrl});e.mapController("address","cmg.controllers.AddressController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=address]")),initAddress()}),cmg.controllers.AddressController=function(){},cmg.controllers.AddressController.inherits(cmt.api.controllers.RequestController),cmg.controllers.AddressController.prototype.getActionSuccess=function(e,t){updateAddress(e.closest(".mapper-item").attr("cid"),t.data)},cmg.controllers.AddressController.prototype.addActionSuccess=function(e,t){e.fadeOut("fast"),e.remove(),addAddressCard(t.data)},cmg.controllers.AddressController.prototype.updateActionSuccess=function(e,t){refreshAddressCard(t.data)},cmg.controllers.AddressController.prototype.deleteActionSuccess=function(e,t){e.closest(".mapper-item").remove()},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("comment","cmt.api.Application",{basePath:ajaxUrl});e.mapController("comment","cmg.controllers.CommentController"),e.mapController("review","cmg.controllers.ReviewController"),e.mapController("feedback","cmg.controllers.FeedbackController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=comment]"))}),cmg.controllers.CommentController=function(){},cmg.controllers.CommentController.inherits(cmt.api.controllers.RequestController),cmg.controllers.ReviewController=function(){},cmg.controllers.ReviewController.inherits(cmt.api.controllers.RequestController),cmg.controllers.ReviewController.prototype.createActionSuccess=function(e,t){e.find(".review-items-wrap").html(""),e.find(".cmt-rating").cmtRate("reset")},cmg.controllers.FeedbackController=function(){},cmg.controllers.FeedbackController.inherits(cmt.api.controllers.RequestController),cmg.controllers.FeedbackController.prototype.createActionSuccess=function(e,t){e.find(".feedback-items-wrap").html(""),e.find(".cmt-rating").cmtRate("reset")},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("grid","cmt.api.Application",{basePath:ajaxUrl});e.mapController("crud","cmg.controllers.grid.CrudController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=grid]"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.grid=cmg.controllers.grid||{},cmg.controllers.grid.CrudController=function(){},cmg.controllers.grid.CrudController.inherits(cmt.api.controllers.RequestController),cmg.controllers.grid.CrudController.prototype.bulkActionSuccess=function(e,t){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.bulkActionFailure=function(e,t){alert("Failed to process your request.")},cmg.controllers.grid.CrudController.prototype.genericActionSuccess=function(e,t){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.genericActionFailure=function(e,t){alert("Failed to process your request.")},cmg.controllers.grid.CrudController.prototype.deleteActionSuccess=function(e,t){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.deleteActionFailure=function(e,t){alert("Failed to process your request.")},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("location","cmt.api.Application",{basePath:ajaxUrl});e.mapController("province","cmg.controllers.location.ProvinceController"),e.mapController("city","cmg.controllers.location.CityController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=location]")),jQuery(".address-province").change(function(){var e=jQuery(this).closest(".frm-address").find(".city-fill");e.find(".id").val(""),e.find(".auto-fill-text").val("")})}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.location=cmg.controllers.location||{},cmg.controllers.location.ProvinceController=function(){},cmg.controllers.location.ProvinceController.inherits(cmt.api.controllers.BaseController),cmg.controllers.location.ProvinceController.prototype.provinceActionPre=function(e){return this.requestData={countryId:e.find("select").val()},!0},cmg.controllers.location.ProvinceController.prototype.provinceActionSuccess=function(e,t){var r=e.parent().find(".wrap-province .cmt-select-wrap");t.data.length<=0&&(t.data='<option value="0">Choose Province</option>'),jQuery.fn.cmtSelect.resetSelect(r,t.data)},cmg.controllers.location.CityController=function(){},cmg.controllers.location.CityController.inherits(cmt.api.controllers.BaseController),cmg.controllers.location.CityController.prototype.autoSearchActionPre=function(e){var t=e.closest(".frm-address"),r=e.closest(".auto-fill"),o=t.find(".address-province").val(),i=t.find(".auto-fill-text").val();return i.length<=0?(r.find(".auto-fill-items").slideUp(),r.find(".auto-fill-target .target").val(""),!1):(this.requestData="province-id="+o+"&name="+i,!0)},cmg.controllers.location.CityController.prototype.autoSearchActionSuccess=function(c,e){var t=e.data,r="",s=c.closest(".auto-fill"),d=s.find(".auto-fill-items");for(i=0;i<t.length;i++){var o=t[i];r+="<li class='auto-fill-item' data-id='"+o.id+"' data-lat='"+o.latitude+"' data-lon='"+o.longitude+"' data-zip='"+o.postal+"'>"+o.name+"</li>"}0==r.length?(r="<li class='auto-fill-message'>No matching results found.</li>",d.html(r)):(d.html(r),c.find(".auto-fill-item").click(function(){var e=s.find(".auto-fill-target .target"),t=jQuery(this).attr("data-id"),r=jQuery(this).html(),o=jQuery(this).attr("data-lat"),i=jQuery(this).attr("data-lon"),l=jQuery(this).attr("data-zip");l=l.split(" "),d.slideUp(),e.val(t),c.find(".auto-fill-text").val(r);var n=jQuery(this).closest(".frm-address"),a=o+","+i;n.find(".search-ll").val(a).trigger("change"),n.find(".address-zip").val(l[0])})),d.slideDown()},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("mapper","cmt.api.Application",{basePath:ajaxUrl});e.mapController("auto","cmg.controllers.mappers.AutoController"),e.mapController("model","cmg.controllers.mappers.ModelController"),e.mapController("csv","cmg.controllers.mappers.CsvController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=mapper]"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.mappers=cmg.controllers.mappers||{},cmg.controllers.mappers.AutoController=function(){this.singleRequest=!0,this.previousLocation=null},cmg.controllers.mappers.AutoController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mappers.AutoController.prototype.autoSearchActionPre=function(e){var t=e.closest(".auto-fill"),r=t.find(".search-name").val(),o=t.find(".search-type");return r.length<=0?(t.find(".auto-fill-items").slideUp(),t.find(".auto-fill-target .target").val(""),!1):(1==o.length?this.requestData="name="+r+"&type="+o.val():this.requestData="name="+r,!0)},cmg.controllers.mappers.AutoController.prototype.autoSearchActionSuccess=function(o,e){var t=e.data,r="",l=o.find(".auto-fill-items");for(i=0;i<t.length;i++){var n=t[i];r+="<li class='auto-fill-item' data-id='"+n.id+"'>"+n.name+"</li>"}0==r.length?(r="<li class='auto-fill-message'>No matching results found.</li>",l.html(r)):(l.html(r),o.find(".auto-fill-item").click(function(){var e=o.closest(".auto-fill").find(".auto-fill-target"),t=jQuery(this).attr("data-id"),r=jQuery(this).html();l.slideUp(),e.find(".target").val(t),o.find(".auto-fill-text").val(r)})),l.slideDown()},cmg.controllers.mappers.ModelController=function(){},cmg.controllers.mappers.ModelController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mappers.ModelController.prototype.autoSearchActionPre=function(e){var t=e.closest(".auto-fill"),r=t.find("input[name=type]"),o=t.find(".auto-fill-text").val(),i=e.closest(".mapper-auto-items").find(".mapper-items").find(".mapper-item").length,l=e.closest(".mapper-auto-items").attr("limit");return o.length<=0?(t.find(".auto-fill-items").slideUp(),t.find(".trigger-map-item input[name=itemId]").val(""),!1):(null!==l&&parseInt(l)<=i&&alert("No more mappings allowed."),1==r.length?this.requestData="name="+o+"&type="+r.val():this.requestData="name="+o,!0)},cmg.controllers.mappers.ModelController.prototype.autoSearchActionSuccess=function(e,t){var r=t.data,o="",l=e.closest(".auto-fill"),n=e.find(".auto-fill-items"),a=e.attr("autoSubmit")||"yes",c=e.attr("template")||"";for(i=0;i<r.length;i++){var s=r[i];o+='<li class="auto-fill-item" data-id="'+s.id+'">'+s.name+"</li>"}0==o.length?(o='<li class="auto-fill-message">No matching results found.</li>',n.html(o)):(n.html(o),e.find(".auto-fill-item").click(function(){var e=jQuery(this).attr("data-id"),t=jQuery(this).html();n.slideUp(),"yes"===a?(l.find(".trigger-map-item input[name=itemId]").val(e),l.find(".trigger-map-item .cmt-click")[0].click()):processAutoSearch(e,t,c)})),n.slideDown()},cmg.controllers.mappers.ModelController.prototype.mapItemActionPre=function(e){var t=e.find("input[name=itemId]").val();return 0<(t=parseInt(t))},cmg.controllers.mappers.ModelController.prototype.mapItemActionSuccess=function(e,t){var r=e.closest(".mapper-auto-items"),o=document.getElementById(r.attr("template")).innerHTML,i=Handlebars.compile(o),l=r.find(".mapper-items"),n=l.find(".mapper-item"),a=n.length,c=t.data.cid,s=t.data.name;r.find(".search-name").val("");for(var d=!0,m=0;m<a;m++){if(c==jQuery(n[m]).find(".cid").val()){d=!1;break}}if(d){var p=i({cid:c,name:s});l.append(p),a=(n=l.find(".mapper-item")).length,cmt.api.utils.request.register(cmt.api.root.getApplication("mapper"),n.last())}},cmg.controllers.mappers.ModelController.prototype.deleteItemActionSuccess=function(e,t){e.remove()},cmg.controllers.mappers.CsvController=function(){},cmg.controllers.mappers.CsvController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mappers.CsvController.prototype.mapItemActionSuccess=function(e,t){var r=jQuery(".mapper-submit-items"),o=r.find(".mapper-items"),i=document.getElementById(r.attr("template")).innerHTML,l=Handlebars.compile(i)({list:t.data});o.html(l),cmt.api.utils.request.register(cmt.api.root.getApplication("mapper"),o.find("[cmt-app=mapper]"))},cmg.controllers.mappers.CsvController.prototype.deleteItemActionSuccess=function(e,t){e.remove()},jQuery(document).ready(function(){cmt.api.root.registerApplication("notify","cmt.api.Application",{basePath:ajaxUrl})}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.notify=cmg.controllers.notify||{},jQuery(document).ready(function(){var e=cmt.api.root.getApplication("notify");e.mapController("notification","cmg.controllers.notify.NotificationController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=notify]"))}),cmg.controllers.notify.NotificationController=function(){},cmg.controllers.notify.NotificationController.inherits(cmt.api.controllers.BaseController),cmg.controllers.notify.NotificationController.prototype.toggleReadActionSuccess=function(e,t){location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.hreadActionSuccess=function(e,t){var r=e.find(".cmt-click").attr("type"),o=t.data.unread;t.data.consumed&&(jQuery(".count-header.count-"+r).html(o),jQuery(".count-sidebar.count-sidebar-header.count-"+r).html(o),jQuery(".count-sidebar.count-sidebar-content.count-"+r).html(o),0==o&&(jQuery(".count-header.count-"+r).fadeOut("fast"),jQuery(".count-sidebar.count-sidebar-header.count-"+r).fadeOut("fast"),jQuery(".count-sidebar.count-sidebar-content.count-"+r).fadeOut("fast"))),e.is("[redirect]")&&(window.location=e.attr("redirect"))},cmg.controllers.notify.NotificationController.prototype.readActionSuccess=function(e,t){e.is("[redirect]")?window.location=e.attr("redirect"):location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.trashActionSuccess=function(e,t){location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.deleteActionSuccess=function(e,t){location.reload(!0)};