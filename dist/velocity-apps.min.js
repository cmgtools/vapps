/**
 * Velocity Apps - v1.0.0-alpha1 - 2018-07-27
 * Description: Velocity Apps is application and controllers library for CMSGears.
 * License: GPL-3.0-or-later
 * Author: Bhagwat Singh Chouhan
 */


var cmg;jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("address","cmt.api.Application",{basePath:ajaxUrl});e.mapController("address","cmg.controllers.address.AddressController"),e.mapService("address","cmg.services.address.AddressService"),cmt.api.utils.request.register(e,jQuery("[cmt-app=address]")),e.getService("address").initListeners(),e.getService("address").refreshGoogleMap(jQuery(".frm-address"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.address=cmg.controllers.address||{},cmg.services=cmg.services||{},cmg.services.address=cmg.services.address||{},cmg.controllers.address.AddressController=function(){},cmg.controllers.address.AddressController.inherits(cmt.api.controllers.RequestController),cmg.controllers.address.AddressController.prototype.getActionSuccess=function(e,t){var r=cmt.api.root.getApplication("address").getService("address"),o=e.closest(".data-crud-address"),c=e.closest(".card-address").attr("cid");r.updateAddress(o,c,t.data)},cmg.controllers.address.AddressController.prototype.addActionSuccess=function(e,t){var r=cmt.api.root.getApplication("address").getService("address"),o=e.closest(".data-crud-address");e.fadeOut("fast"),e.remove(),r.addAddressCard(o,t.data)},cmg.controllers.address.AddressController.prototype.updateActionSuccess=function(e,t){var r=cmt.api.root.getApplication("address").getService("address"),o=e.closest(".data-crud-address");r.refreshAddressCard(o,t.data)},cmg.controllers.address.AddressController.prototype.deleteActionSuccess=function(e,t){e.closest(".card-address").remove()},cmg.services.address.AddressService=function(){},cmg.services.address.AddressService.inherits(cmt.api.services.BaseService),cmg.services.address.AddressService.prototype.initListeners=function(){var e=this;jQuery("#btn-add-address").click(function(){e.addAddress("#"+jQuery(this).attr("data-target"))})},cmg.services.address.AddressService.prototype.addAddress=function(e){var t=document.getElementById("addAddressTemplate").innerHTML,r=Handlebars.compile(t)({});(e=jQuery(e).find(".address-form-wrap")).hide(),e.html(r),e.fadeIn("slow"),cmt.api.utils.request.registerTargetApp("address",e),cmt.api.utils.request.registerTargetApp("location",e),e.find(".cmt-select").cmtSelect({iconHtml:'<span class="cmti cmti-chevron-down"></span>'}),e.find(".address-form-close").click(function(){e.hide()}),this.refreshGoogleMap(e)},cmg.services.address.AddressService.prototype.updateAddress=function(e,t,r){var o=document.getElementById("updateAddressTemplate").innerHTML,c=Handlebars.compile(o)({cid:t,address:r.address}),i=e.find(".address-form-wrap");i.hide(),i.html(c),i.fadeIn("slow");var l=i.find(".address-country"),s=i.find(".address-province"),n=i.find(".address-region");l.val(l.attr("cid")),s.val(s.attr("pid")),1===n.length&&n.val(n.attr("rid")),i.find(".address-select").val(r.type),cmt.api.utils.request.registerTargetApp("address",i),cmt.api.utils.request.registerTargetApp("location",i),i.find(".cmt-select").cmtSelect({iconHtml:'<span class="cmti cmti-chevron-down"></span>'}),i.find(".address-form-close").click(function(){i.hide()}),this.refreshGoogleMap(i),this.refreshProvinces(i,s.attr("pid")),this.refreshRegions(i,n.attr("rid"))},cmg.services.address.AddressService.prototype.addAddressCard=function(e,t){var r=document.getElementById("addressCardTemplate").innerHTML,o=Handlebars.compile(r)({address:t}),c=e.find(".address-cards");c.append(o),cmt.api.utils.request.register(cmt.api.root.getApplication("address"),c.find("[cmt-app=address]"))},cmg.services.address.AddressService.prototype.refreshAddressCard=function(e,t){var r=document.getElementById("refreshAddressCardTemplate").innerHTML,o=Handlebars.compile(r)({address:t}),c=e.find(".address-cards").find("#card-address-"+t.cid);c.html(o),e.find(".address-form-wrap").fadeOut(),cmt.api.utils.request.register(cmt.api.root.getApplication("address"),c.find("[cmt-app=address]"))},cmg.services.address.AddressService.prototype.refreshProvinces=function(e,t){e.find(".address-country").attr("province",t),e.find(".address-country").closest(".wrap-country").find(".cmt-click").trigger("click")},cmg.services.address.AddressService.prototype.refreshRegions=function(e,t){e.find(".address-province").attr("region",t),e.find(".address-province").closest(".wrap-province").find(".cmt-click").trigger("click")},cmg.services.address.AddressService.prototype.refreshGoogleMap=function(e){jQuery(e).find(".lat-long-picker").latLongPicker(),jQuery(e).find(".frm-ll-picker .line1, .frm-ll-picker .line2, .frm-ll-picker .line3, .frm-ll-picker .city, .frm-ll-picker .zip").keyup(function(){var e=jQuery(".frm-ll-picker .line1").val()+","+jQuery(".frm-ll-picker .line2").val()+","+jQuery(".frm-ll-picker .city").val()+","+jQuery(".frm-ll-picker .zip").val();10<e.length&&jQuery(".frm-ll-picker .search-box").val(e).trigger("change")})},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("comment","cmt.api.Application",{basePath:ajaxUrl});e.mapController("comment","cmg.controllers.comment.CommentController"),e.mapController("review","cmg.controllers.comment.ReviewController"),e.mapController("feedback","cmg.controllers.comment.FeedbackController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=comment]"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.comment=cmg.controllers.comment||{},cmg.services=cmg.services||{},cmg.services.comment=cmg.services.comment||{},cmg.controllers.comment.CommentController=function(){},cmg.controllers.comment.CommentController.inherits(cmt.api.controllers.RequestController),cmg.controllers.comment.CommentController.prototype.createActionSuccess=function(e,t){e.find(".cmt-rating").cmtRate("reset")},cmg.controllers.comment.ReviewController=function(){},cmg.controllers.comment.ReviewController.inherits(cmt.api.controllers.RequestController),cmg.controllers.comment.ReviewController.prototype.createActionSuccess=function(e,t){e.find(".gallery-review").html(""),e.find(".cmt-rating").cmtRate("reset")},cmg.controllers.comment.FeedbackController=function(){},cmg.controllers.comment.FeedbackController.inherits(cmt.api.controllers.RequestController),cmg.controllers.comment.FeedbackController.prototype.createActionSuccess=function(e,t){e.find(".gallery-feedback").html(""),e.find(".cmt-rating").cmtRate("reset")},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("grid","cmt.api.Application",{basePath:ajaxUrl});e.mapController("crud","cmg.controllers.grid.CrudController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=grid]"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.grid=cmg.controllers.grid||{},cmg.services=cmg.services||{},cmg.services.grid=cmg.services.grid||{},cmg.controllers.grid.CrudController=function(){},cmg.controllers.grid.CrudController.inherits(cmt.api.controllers.RequestController),cmg.controllers.grid.CrudController.prototype.bulkActionSuccess=function(e,t){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.bulkActionFailure=function(e,t){alert("Failed to process your request.")},cmg.controllers.grid.CrudController.prototype.genericActionSuccess=function(e,t){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.genericActionFailure=function(e,t){alert("Failed to process your request.")},cmg.controllers.grid.CrudController.prototype.deleteActionSuccess=function(e,t){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.deleteActionFailure=function(e,t){alert("Failed to process your request.")},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("location","cmt.api.Application",{basePath:ajaxUrl});e.mapController("province","cmg.controllers.location.ProvinceController"),e.mapController("region","cmg.controllers.location.RegionController"),e.mapController("city","cmg.controllers.location.CityController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=location]")),jQuery(".address-province, .address-region").change(function(){var e=jQuery(this).closest(".frm-address").find(".city-fill");e.find(".id").val(""),e.find(".auto-fill-text").val("")})}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.location=cmg.controllers.location||{},cmg.services=cmg.services||{},cmg.services.location=cmg.services.location||{},cmg.controllers.location.ProvinceController=function(){},cmg.controllers.location.ProvinceController.inherits(cmt.api.controllers.BaseController),cmg.controllers.location.ProvinceController.prototype.optionsListActionPre=function(e){var t=e.find("select");return this.requestData="country-id="+t.val(),cmt.utils.data.hasAttribute(t,"province")&&(this.requestData+="&province-id="+t.attr("province")),!0},cmg.controllers.location.ProvinceController.prototype.optionsListActionSuccess=function(e,t){var r=e.closest(".frm-address").find(".wrap-province .cmt-select-wrap");jQuery.fn.cmtSelect.resetSelect(r,t.data)},cmg.controllers.location.RegionController=function(){},cmg.controllers.location.RegionController.inherits(cmt.api.controllers.BaseController),cmg.controllers.location.RegionController.prototype.optionsListActionPre=function(e){var t=e.find("select");return this.requestData="province-id="+t.val(),cmt.utils.data.hasAttribute(t,"region")&&(this.requestData+="&region-id="+t.attr("region")),!0},cmg.controllers.location.RegionController.prototype.optionsListActionSuccess=function(e,t){var r=e.closest(".frm-address").find(".wrap-region .cmt-select-wrap");jQuery.fn.cmtSelect.resetSelect(r,t.data)},cmg.controllers.location.CityController=function(){},cmg.controllers.location.CityController.inherits(cmt.api.controllers.BaseController),cmg.controllers.location.CityController.prototype.autoSearchActionPre=function(e){var t=e.closest(".frm-address"),r=e.closest(".auto-fill"),o=t.find(".address-province").val(),c=t.find(".address-region").val(),i=t.find(".auto-fill-text").val();return i.length<=0?(r.find(".auto-fill-items").slideUp(),r.find(".auto-fill-target .target").val(""),!1):(this.requestData="province-id="+o+"&region-id="+c+"&name="+i,!0)},cmg.controllers.location.CityController.prototype.autoSearchActionSuccess=function(n,e){var t=e.data,r="",a=n.closest(".auto-fill"),d=a.find(".auto-fill-items");for(i=0;i<t.length;i++){var o=t[i];r+="<li class='auto-fill-item' data-id='"+o.id+"' data-lat='"+o.latitude+"' data-lon='"+o.longitude+"' data-zip='"+o.postal+"'>"+o.name+"</li>"}0==r.length?(r="<li class='auto-fill-message'>No matching results found.</li>",d.html(r)):(d.html(r),n.find(".auto-fill-item").click(function(){var e=a.find(".auto-fill-target .target"),t=jQuery(this).attr("data-id"),r=jQuery(this).html(),o=jQuery(this).attr("data-lat"),c=jQuery(this).attr("data-lon"),i=jQuery(this).attr("data-zip");i=i.split(" "),d.slideUp(),e.val(t),n.find(".auto-fill-text").val(r);var l=jQuery(this).closest(".frm-address"),s=o+","+c;l.find(".search-ll").val(s).trigger("change"),l.find(".address-zip").val(i[0])})),d.slideDown()},jQuery(document).ready(function(){var e=cmt.api.root.registerApplication("mapper","cmt.api.Application",{basePath:ajaxUrl});e.mapController("auto","cmg.controllers.mapper.AutoController"),e.mapController("model","cmg.controllers.mapper.ModelController"),e.mapController("csv","cmg.controllers.mapper.CsvController"),e.mapService("auto","cmg.services.mapper.AutoService"),cmt.api.utils.request.register(e,jQuery("[cmt-app=mapper]"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.mapper=cmg.controllers.mapper||{},cmg.services=cmg.services||{},cmg.services.mapper=cmg.services.mapper||{},cmg.controllers.mapper.AutoController=function(){this.singleRequest=!0,this.previousLocation=null},cmg.controllers.mapper.AutoController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mapper.AutoController.prototype.autoSearchActionPre=function(e){var t=e.closest(".auto-fill"),r=t.find(".search-name").val(),o=t.find(".search-type");return r.length<=0?(t.find(".auto-fill-items").slideUp(),t.find(".auto-fill-target .target").val(""),!1):(1==o.length?this.requestData="name="+r+"&type="+o.val():this.requestData="name="+r,!0)},cmg.controllers.mapper.AutoController.prototype.autoSearchActionSuccess=function(o,e){var t=e.data,r="",c=o.find(".auto-fill-items");for(i=0;i<t.length;i++){var l=t[i];r+="<li class='auto-fill-item' data-id='"+l.id+"'>"+l.name+"</li>"}0==r.length?(r="<li class='auto-fill-message'>No matching results found.</li>",c.html(r)):(c.html(r),o.find(".auto-fill-item").click(function(){var e=o.closest(".auto-fill").find(".auto-fill-target"),t=jQuery(this).attr("data-id"),r=jQuery(this).html();c.slideUp(),e.find(".target").val(t),o.find(".auto-fill-text").val(r)})),c.slideDown()},cmg.controllers.mapper.ModelController=function(){},cmg.controllers.mapper.ModelController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mapper.ModelController.prototype.autoSearchActionPre=function(e){var t=e.closest(".auto-fill"),r=t.find("input[name=type]"),o=t.find(".auto-fill-text").val(),c=e.closest(".mapper-auto-items").find(".mapper-items").find(".mapper-item").length,i=e.closest(".mapper-auto-items").attr("limit");return o.length<=0?(t.find(".auto-fill-items").slideUp(),t.find(".trigger-map-item input[name=itemId]").val(""),!1):(null!==i&&parseInt(i)<=c&&alert("No more mappings allowed."),1==r.length?this.requestData="name="+o+"&type="+r.val():this.requestData="name="+o,!0)},cmg.controllers.mapper.ModelController.prototype.autoSearchActionSuccess=function(e,t){var r=t.data,o="",c=e.closest(".auto-fill"),l=e.find(".auto-fill-items"),s=e.attr("autoSubmit")||"yes",n=e.attr("template")||"";for(i=0;i<r.length;i++){var a=r[i];o+='<li class="auto-fill-item" data-id="'+a.id+'">'+a.name+"</li>"}0==o.length?(o='<li class="auto-fill-message">No matching results found.</li>',l.html(o)):(l.html(o),e.find(".auto-fill-item").click(function(){var e=jQuery(this).attr("data-id"),t=jQuery(this).html();l.slideUp(),"yes"===s?(c.find(".trigger-map-item input[name=itemId]").val(e),c.find(".trigger-map-item .cmt-click")[0].click()):cmt.api.root.getApplication("mapper").getService("auto").processAutoSearch(e,t,n)})),l.slideDown()},cmg.controllers.mapper.ModelController.prototype.mapItemActionPre=function(e){var t=e.find("input[name=itemId]").val();return 0<(t=parseInt(t))},cmg.controllers.mapper.ModelController.prototype.mapItemActionSuccess=function(e,t){var r=e.closest(".mapper-auto-items"),o=document.getElementById(r.attr("template")).innerHTML,c=Handlebars.compile(o),i=r.find(".mapper-items"),l=i.find(".mapper-item"),s=l.length,n=t.data.cid,a=t.data.name;r.find(".search-name").val("");for(var d=!0,m=0;m<s;m++){if(n==jQuery(l[m]).find(".cid").val()){d=!1;break}}if(d){var p=c({cid:n,name:a});i.append(p),s=(l=i.find(".mapper-item")).length,cmt.api.utils.request.register(cmt.api.root.getApplication("mapper"),l.last())}},cmg.controllers.mapper.ModelController.prototype.deleteItemActionSuccess=function(e,t){e.remove()},cmg.controllers.mapper.CsvController=function(){},cmg.controllers.mapper.CsvController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mapper.CsvController.prototype.mapItemActionSuccess=function(e,t){var r=jQuery(".mapper-submit-items"),o=r.find(".mapper-items"),c=document.getElementById(r.attr("template")).innerHTML,i=Handlebars.compile(c)({list:t.data});o.html(i),cmt.api.utils.request.register(cmt.api.root.getApplication("mapper"),o.find("[cmt-app=mapper]"))},cmg.controllers.mapper.CsvController.prototype.deleteItemActionSuccess=function(e,t){e.remove()},cmg.services.mapper.AutoService=function(){},cmg.services.mapper.AutoService.inherits(cmt.api.services.BaseService),cmg.services.mapper.AutoService.prototype.processAutoSearch=function(e,t,r){var o=document.getElementById(r).innerHTML,c=(r=Handlebars.compile(o),jQuery(".mapper-auto-categories").find(".mapper-items")),i=c.find(".mapper-item"),l=i.length;if(jQuery(".mapper-auto-categories .search-name").val(""),5<=l)alert("No more mappings allowed.");else{for(var s=!0,n=0;n<l;n++){if(e==jQuery(i[n]).find(".id").val()){s=!1;break}}if(s){var a=r({id:e,name:t});c.append(a),l=(i=c.find(".mapper-item")).length,i.last().find(".mapper-item-remove").click(function(){jQuery(this).closest(".mapper-item").remove()})}}},jQuery(document).ready(function(){cmt.api.root.registerApplication("notify","cmt.api.Application",{basePath:ajaxUrl})}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.notify=cmg.controllers.notify||{},cmg.services=cmg.services||{},cmg.services.notify=cmg.services.notify||{},jQuery(document).ready(function(){var e=cmt.api.root.getApplication("notify");e.mapController("notification","cmg.controllers.notify.NotificationController"),cmt.api.utils.request.register(e,jQuery("[cmt-app=notify]"))}),cmg.controllers.notify.NotificationController=function(){},cmg.controllers.notify.NotificationController.inherits(cmt.api.controllers.BaseController),cmg.controllers.notify.NotificationController.prototype.toggleReadActionSuccess=function(e,t){location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.hreadActionSuccess=function(e,t){var r=e.find(".cmt-click").attr("type"),o=t.data.unread;t.data.consumed&&(jQuery(".count-header.count-"+r).html(o),jQuery(".count-sidebar.count-sidebar-header.count-"+r).html(o),jQuery(".count-sidebar.count-sidebar-content.count-"+r).html(o),0==o&&(jQuery(".count-header.count-"+r).fadeOut("fast"),jQuery(".count-sidebar.count-sidebar-header.count-"+r).fadeOut("fast"),jQuery(".count-sidebar.count-sidebar-content.count-"+r).fadeOut("fast"))),e.is("[redirect]")&&(window.location=e.attr("redirect"))},cmg.controllers.notify.NotificationController.prototype.readActionSuccess=function(e,t){e.is("[redirect]")?window.location=e.attr("redirect"):location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.trashActionSuccess=function(e,t){location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.deleteActionSuccess=function(e,t){location.reload(!0)};