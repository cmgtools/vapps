/**
 * Velocity Apps - v1.0.0-alpha1 - 2018-05-28
 * Description: Velocity Apps is application and controllers library for CMSGears.
 * License: GPL-3.0-or-later
 * Author: Bhagwat Singh Chouhan
 */


function initCommentListeners(){jQuery(".reviews-uploader").cmtFileUploader({uploadListener:reviewItemListener}),jQuery(".review-items-wrap .btn-delete").click(function(){jQuery(this).closest(".review-item").remove(),resetReviewItemCounter()})}function reviewItemListener(t,e,r,o){var l=jQuery(".reviews-uploader .form-wrap"),i=l.find(".title"),n=l.find(".desc"),c=jQuery(".review-items-wrap .review-item").length,a=document.getElementById("reviewItemTemplate").innerHTML,s=Handlebars.compile(a)({count:c,data:o,title:i.val(),description:n.val()});i.val(""),n.val(""),jQuery(".review-items-wrap").append(s),jQuery(".review-items-wrap .btn-delete").last().click(function(){jQuery(this).closest(".review-item").remove(),resetReviewItemCounter()}),resetReviewItemCounter()}function resetReviewItemCounter(){jQuery(".review-items-wrap .review-item").each(function(t,e){var r=jQuery(this);r.find(".id").attr("name","File["+t+"][id]"),r.find(".name").attr("name","File["+t+"][name]"),r.find(".extension").attr("name","File["+t+"][extension]"),r.find(".directory").attr("name","File["+t+"][directory]"),r.find(".type").attr("name","File["+t+"][type]"),r.find(".changed").attr("name","File["+t+"][changed]"),r.find(".title").attr("name","File["+t+"][title]"),r.find(".description").attr("name","File["+t+"][description]")})}var cmg;function processAutoSearch(t,e,r){var o=document.getElementById(r).innerHTML,l=(r=Handlebars.compile(o),jQuery(".mapper-auto-categories").find(".mapper-items")),i=l.find(".mapper-item"),n=i.length;if(jQuery(".mapper-auto-categories .search-name").val(""),5<=n)alert("No more mappings allowed.");else{for(var c=!0,a=0;a<n;a++){if(t==jQuery(i[a]).find(".id").val()){c=!1;break}}if(c){var s=r({id:t,name:e});l.append(s),n=(i=l.find(".mapper-item")).length,i.last().find(".mapper-item-remove").click(function(){jQuery(this).closest(".mapper-item").remove()})}}}jQuery(document).ready(function(){var t=cmt.api.root.registerApplication("comment","cmt.api.Application",{basePath:ajaxUrl});t.mapController("comment","cmg.controllers.CommentController"),t.mapController("review","cmg.controllers.ReviewController"),t.mapController("feedback","cmg.controllers.FeedbackController"),cmt.api.utils.request.register(t,jQuery("[cmt-app=comment]"))}),cmg.controllers.CommentController=function(){},cmg.controllers.CommentController.inherits(cmt.api.controllers.RequestController),cmg.controllers.ReviewController=function(){},cmg.controllers.ReviewController.inherits(cmt.api.controllers.RequestController),cmg.controllers.ReviewController.prototype.createActionSuccess=function(t,e){t.find(".review-items-wrap").html(""),t.find(".cmt-rating").cmtRate("reset")},cmg.controllers.FeedbackController=function(){},cmg.controllers.FeedbackController.inherits(cmt.api.controllers.RequestController),cmg.controllers.FeedbackController.prototype.createActionSuccess=function(t,e){t.find(".feedback-items-wrap").html(""),t.find(".cmt-rating").cmtRate("reset")},jQuery(document).ready(function(){var t=cmt.api.root.registerApplication("grid","cmt.api.Application",{basePath:ajaxUrl});t.mapController("crud","cmg.controllers.grid.CrudController"),cmt.api.utils.request.register(t,jQuery("[cmt-app=grid]"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.grid=cmg.controllers.grid||{},cmg.controllers.grid.CrudController=function(){},cmg.controllers.grid.CrudController.inherits(cmt.api.controllers.RequestController),cmg.controllers.grid.CrudController.prototype.bulkActionSuccess=function(t,e){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.bulkActionFailure=function(t,e){alert("Failed to process your request.")},cmg.controllers.grid.CrudController.prototype.genericActionSuccess=function(t,e){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.genericActionFailure=function(t,e){alert("Failed to process your request.")},cmg.controllers.grid.CrudController.prototype.deleteActionSuccess=function(t,e){cmt.utils.data.refreshGrid()},cmg.controllers.grid.CrudController.prototype.deleteActionFailure=function(t,e){alert("Failed to process your request.")},jQuery(document).ready(function(){var t=cmt.api.root.registerApplication("location","cmt.api.Application",{basePath:ajaxUrl});t.mapController("province","cmg.controllers.location.ProvinceController"),t.mapController("city","cmg.controllers.location.CityController"),cmt.api.utils.request.register(t,jQuery("[cmt-app=location]")),jQuery(".address-province").change(function(){var t=jQuery(this).closest(".frm-address").find(".city-fill");t.find(".id").val(""),t.find(".auto-fill-text").val("")})}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.location=cmg.controllers.location||{},cmg.controllers.location.ProvinceController=function(){},cmg.controllers.location.ProvinceController.inherits(cmt.api.controllers.BaseController),cmg.controllers.location.ProvinceController.prototype.provinceActionPre=function(t){return this.requestData={countryId:t.find("select").val()},!0},cmg.controllers.location.ProvinceController.prototype.provinceActionSuccess=function(t,e){var r=t.parent().find(".wrap-province .cmt-select-wrap");e.data.length<=0&&(e.data='<option value="0">Choose Province</option>'),jQuery.fn.cmtSelect.resetSelect(r,e.data),jQuery(".frm-province .cmt-select-wrap select").remove(),jQuery(".frm-province .cmt-select-wrap").empty(),jQuery(".frm-province ").html("<label>State/Province</label><select id='wrap-province' class='element-60 cmt-select cmt-change' name='Address[provinceId]'>"+e.data.provinceList+"</select>"),jQuery(".frm-province .cmt-select").cmtSelect({iconHtml:'<span class="cmti cmti-chevron-down"></span>'})},cmg.controllers.location.CityController=function(){},cmg.controllers.location.CityController.inherits(cmt.api.controllers.BaseController),cmg.controllers.location.CityController.prototype.autoSearchActionPre=function(t){var e=t.closest(".frm-address"),r=t.closest(".auto-fill"),o=e.find(".address-province").val(),l=e.find(".auto-fill-text").val();return l.length<=0?(r.find(".auto-fill-items").slideUp(),r.find(".auto-fill-target .target").val(""),!1):(this.requestData="province-id="+o+"&name="+l,!0)},cmg.controllers.location.CityController.prototype.autoSearchActionSuccess=function(a,t){var e=t.data,r="",s=a.closest(".auto-fill"),m=s.find(".auto-fill-items");for(i=0;i<e.length;i++){var o=e[i];r+="<li class='auto-fill-item' data-id='"+o.id+"' data-lat='"+o.latitude+"' data-lon='"+o.longitude+"' data-zip='"+o.postal+"'>"+o.name+"</li>"}0==r.length?(r="<li class='auto-fill-message'>No matching results found.</li>",m.html(r)):(m.html(r),a.find(".auto-fill-item").click(function(){var t=s.find(".auto-fill-target .target"),e=jQuery(this).attr("data-id"),r=jQuery(this).html(),o=jQuery(this).attr("data-lat"),l=jQuery(this).attr("data-lon"),i=jQuery(this).attr("data-zip");i=i.split(" "),m.slideUp(),t.val(e),a.find(".auto-fill-text").val(r);var n=jQuery(this).closest(".frm-address"),c=o+","+l;n.find(".search-ll").val(c).trigger("change"),n.find(".address-zip").val(i[0])})),m.slideDown()},jQuery(document).ready(function(){var t=cmt.api.root.registerApplication("mapper","cmt.api.Application",{basePath:ajaxUrl});t.mapController("auto","cmg.controllers.mappers.AutoController"),t.mapController("model","cmg.controllers.mappers.ModelController"),t.mapController("csv","cmg.controllers.mappers.CsvController"),cmt.api.utils.request.register(t,jQuery("[cmt-app=mapper]"))}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.mappers=cmg.controllers.mappers||{},cmg.controllers.mappers.AutoController=function(){this.singleRequest=!0,this.previousLocation=null},cmg.controllers.mappers.AutoController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mappers.AutoController.prototype.autoSearchActionPre=function(t){var e=t.closest(".auto-fill"),r=e.find(".search-name").val(),o=e.find(".search-type");return r.length<=0?(e.find(".auto-fill-items").slideUp(),e.find(".auto-fill-target .target").val(""),!1):(1==o.length?this.requestData="name="+r+"&type="+o.val():this.requestData="name="+r,!0)},cmg.controllers.mappers.AutoController.prototype.autoSearchActionSuccess=function(o,t){var e=t.data,r="",l=o.find(".auto-fill-items");for(i=0;i<e.length;i++){var n=e[i];r+="<li class='auto-fill-item' data-id='"+n.id+"'>"+n.name+"</li>"}0==r.length?(r="<li class='auto-fill-message'>No matching results found.</li>",l.html(r)):(l.html(r),o.find(".auto-fill-item").click(function(){var t=o.closest(".auto-fill").find(".auto-fill-target"),e=jQuery(this).attr("data-id"),r=jQuery(this).html();l.slideUp(),t.find(".target").val(e),o.find(".auto-fill-text").val(r)})),l.slideDown()},cmg.controllers.mappers.ModelController=function(){},cmg.controllers.mappers.ModelController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mappers.ModelController.prototype.autoSearchActionPre=function(t){var e=t.closest(".auto-fill"),r=e.find("input[name=type]"),o=e.find(".auto-fill-text").val(),l=t.closest(".mapper-auto-items").find(".mapper-items").find(".mapper-item").length,i=t.closest(".mapper-auto-items").attr("limit");return o.length<=0?(e.find(".auto-fill-items").slideUp(),e.find(".trigger-map-item input[name=itemId]").val(""),!1):(null!==i&&parseInt(i)<=l&&alert("No more mappings allowed."),1==r.length?this.requestData="name="+o+"&type="+r.val():this.requestData="name="+o,!0)},cmg.controllers.mappers.ModelController.prototype.autoSearchActionSuccess=function(t,e){var r=e.data,o="",l=t.closest(".auto-fill"),n=t.find(".auto-fill-items"),c=t.attr("autoSubmit")||"yes",a=t.attr("template")||"";for(i=0;i<r.length;i++){var s=r[i];o+='<li class="auto-fill-item" data-id="'+s.id+'">'+s.name+"</li>"}0==o.length?(o='<li class="auto-fill-message">No matching results found.</li>',n.html(o)):(n.html(o),t.find(".auto-fill-item").click(function(){var t=jQuery(this).attr("data-id"),e=jQuery(this).html();n.slideUp(),"yes"===c?(l.find(".trigger-map-item input[name=itemId]").val(t),l.find(".trigger-map-item .cmt-click")[0].click()):processAutoSearch(t,e,a)})),n.slideDown()},cmg.controllers.mappers.ModelController.prototype.mapItemActionPre=function(t){var e=t.find("input[name=itemId]").val();return 0<(e=parseInt(e))},cmg.controllers.mappers.ModelController.prototype.mapItemActionSuccess=function(t,e){var r=t.closest(".mapper-auto-items"),o=document.getElementById(r.attr("template")).innerHTML,l=Handlebars.compile(o),i=r.find(".mapper-items"),n=i.find(".mapper-item"),c=n.length,a=e.data.cid,s=e.data.name;r.find(".search-name").val("");for(var m=!0,p=0;p<c;p++){if(a==jQuery(n[p]).find(".cid").val()){m=!1;break}}if(m){var u=l({cid:a,name:s});i.append(u),c=(n=i.find(".mapper-item")).length,cmt.api.utils.request.register(cmt.api.root.getApplication("mapper"),n.last())}},cmg.controllers.mappers.ModelController.prototype.deleteItemActionSuccess=function(t,e){t.remove()},cmg.controllers.mappers.CsvController=function(){},cmg.controllers.mappers.CsvController.inherits(cmt.api.controllers.RequestController),cmg.controllers.mappers.CsvController.prototype.mapItemActionSuccess=function(t,e){var r=jQuery(".mapper-submit-items"),o=r.find(".mapper-items"),l=document.getElementById(r.attr("template")).innerHTML,i=Handlebars.compile(l)({list:e.data});o.html(i),cmt.api.utils.request.register(cmt.api.root.getApplication("mapper"),o.find("[cmt-app=mapper]"))},cmg.controllers.mappers.CsvController.prototype.deleteItemActionSuccess=function(t,e){t.remove()},jQuery(document).ready(function(){cmt.api.root.registerApplication("notify","cmt.api.Application",{basePath:ajaxUrl})}),(cmg=cmg||{}).controllers=cmg.controllers||{},cmg.controllers.notify=cmg.controllers.notify||{},jQuery(document).ready(function(){var t=cmt.api.root.getApplication("notify");t.mapController("notification","cmg.controllers.notify.NotificationController"),cmt.api.utils.request.register(t,jQuery("[cmt-app=notify]"))}),cmg.controllers.notify.NotificationController=function(){},cmg.controllers.notify.NotificationController.inherits(cmt.api.controllers.BaseController),cmg.controllers.notify.NotificationController.prototype.toggleReadActionSuccess=function(t,e){location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.hreadActionSuccess=function(t,e){var r=t.find(".cmt-click").attr("type"),o=e.data.unread;e.data.consumed&&(jQuery(".count-header.count-"+r).html(o),jQuery(".count-sidebar.count-sidebar-header.count-"+r).html(o),jQuery(".count-sidebar.count-sidebar-content.count-"+r).html(o),0==o&&(jQuery(".count-header.count-"+r).fadeOut("fast"),jQuery(".count-sidebar.count-sidebar-header.count-"+r).fadeOut("fast"),jQuery(".count-sidebar.count-sidebar-content.count-"+r).fadeOut("fast"))),t.is("[redirect]")&&(window.location=t.attr("redirect"))},cmg.controllers.notify.NotificationController.prototype.readActionSuccess=function(t,e){t.is("[redirect]")?window.location=t.attr("redirect"):location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.trashActionSuccess=function(t,e){location.reload(!0)},cmg.controllers.notify.NotificationController.prototype.deleteActionSuccess=function(t,e){location.reload(!0)};